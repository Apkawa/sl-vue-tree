!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SlVueTree=t():e.SlVueTree=t()}(window,function(){return function(e){var t={};function o(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=4)}({4:function(e,t,o){"use strict";o.r(t);var s={name:"sl-vue-tree",props:{value:{type:Array,default:()=>[]},edgeSize:{type:Number,default:3},showBranches:{type:Boolean,default:!1},level:{type:Number,default:0},parentInd:{type:Number},allowMultiselect:{type:Boolean,default:!0},multiselectKey:{type:[String,Array],default:function(){return["ctrlKey","metaKey"]},validator:function(e){let t=["ctrlKey","metaKey","altKey"],o=Array.isArray(e)?e:[e];return!!(o=o.filter(e=>-1!==t.indexOf(e))).length}},scrollAreaHeight:{type:Number,default:70},maxScrollSpeed:{type:Number,default:20},allowDrop:{type:Function},allowDrag:{type:Function}},data(){return{rootCursorPosition:null,scrollIntervalId:0,scrollSpeed:0,lastSelectedNode:null,mouseIsDown:!1,isDragging:!1,lastMousePos:{x:0,y:0},preventDrag:!1,currentValue:this.value,dropAllow:!0,dropMove:!0,dropCopy:!1}},mounted(){this.isRoot&&document.addEventListener("mouseup",this.onDocumentMouseupHandler)},beforeDestroy(){document.removeEventListener("mouseup",this.onDocumentMouseupHandler)},watch:{value:function(e){this.currentValue=e}},computed:{cursorPosition(){return this.isRoot?this.rootCursorPosition:this.getParent().cursorPosition},nodes(){if(this.isRoot){const e=this.copy(this.currentValue);return this.getNodes(e)}return this.getParent().nodes[this.parentInd].children},gaps(){const e=[];let t=this.level-1;for(this.showBranches||t++;t-- >0;)e.push(t);return e},isRoot(){return!this.level},selectionSize(){return this.getSelected().length},dragSize(){return this.getDraggable().length}},methods:{setCursorPosition(e){this.isRoot?this.rootCursorPosition=e:this.getParent().setCursorPosition(e)},getNodes(e,t=[],o=!0){return e.map((s,r)=>{const i=t.concat(r);return this.getNode(i,s,e,o)})},getNode(e,t=null,o=null,s=null){const r=e.slice(-1)[0];if(o=o||this.getNodeSiblings(this.currentValue,e),t=t||o&&o[r]||null,null==s&&(s=this.isVisible(e)),!t)return null;const i=void 0==t.isExpanded||!!t.isExpanded,n=void 0==t.isDraggable||!!t.isDraggable,l=void 0==t.isSelectable||!!t.isSelectable,a=void 0==t.isAllowDrag||!!t.isAllowDrag,u=void 0==t.isAllowDrop||!!t.isAllowDrop;return{title:t.title,isLeaf:!!t.isLeaf,children:t.children?this.getNodes(t.children,e,i):[],isSelected:!!t.isSelected,isExpanded:i,isVisible:s,isDraggable:n,isSelectable:l,isAllowDrag:a,isAllowDrop:u,data:void 0!==t.data?t.data:{},path:e,pathStr:JSON.stringify(e),level:e.length,ind:r,isFirstChild:0===r,isLastChild:r===o.length-1}},isVisible(e){if(e.length<2)return!0;let t=this.currentValue;for(let o=0;o<e.length-1;o++){let s=t[e[o]];if(!(void 0===s.isExpanded||!!s.isExpanded))return!1;t=s.children}return!0},emitInput(e){this.currentValue=e,this.getRoot().$emit("input",e)},emitSelect(e,t){this.getRoot().$emit("select",e,t)},emitDrop(e,t,o){this.getRoot().$emit("drop",e,t,o)},emitToggle(e,t){this.getRoot().$emit("toggle",e,t)},emitNodeClick(e,t){this.getRoot().$emit("nodeclick",e,t)},emitNodeDblclick(e,t){this.getRoot().$emit("nodedblclick",e,t)},emitNodeContextmenu(e,t){this.getRoot().$emit("nodecontextmenu",e,t)},onExternalDragoverHandler(e,t){t.preventDefault();const o=this.getRoot(),s=o.getCursorPositionFromCoords(t.clientX,t.clientY);o.setCursorPosition(s),o.$emit("externaldragover",s,t)},onExternalDropHandler(e,t){const o=this.getRoot(),s=o.getCursorPositionFromCoords(t.clientX,t.clientY);o.$emit("externaldrop",s,t),this.setCursorPosition(null)},select(e,t=!1,o=null){const s=Array.isArray(this.multiselectKey)?this.multiselectKey:[this.multiselectKey],r=o&&!!s.find(e=>o[e]);t=(r||t)&&this.allowMultiselect;const i=this.getNode(e);if(!i)return null;const n=this.copy(this.currentValue),l=this.allowMultiselect&&o&&o.shiftKey&&this.lastSelectedNode,a=[];let u=!1;return this.traverse((e,o)=>{l?(e.pathStr!==i.pathStr&&e.pathStr!==this.lastSelectedNode.pathStr||(o.isSelected=e.isSelectable,u=!u),u&&(o.isSelected=e.isSelectable)):e.pathStr===i.pathStr?o.isSelected=e.isSelectable:t||o.isSelected&&(o.isSelected=!1),o.isSelected&&a.push(e)},n),this.lastSelectedNode=i,this.emitInput(n),this.emitSelect(a,o),i},_checkAllowDrag(e,t){if(!e.length)return!1;if("function"==typeof this.allowDrag&&!this.allowDrag(e,t))return!1;for(let t of e)if(!t.isAllowDrag)return!1;return!0},_checkAllowDrop(e,t,o){const{node:s,placement:r}=t;if("inside"===r&&!s.isAllowDrop)return!1;const i=this.getParentNodes(s.path);for(let e of i)if(!e.isAllowDrop)return!1;return!("function"==typeof this.allowDrop&&!this.allowDrop(e,t,o))},onMousemoveHandler(e){if(!this.isRoot)return void this.getRoot().onMousemoveHandler(e);if(this.preventDrag)return;const t=this.isDragging,o=this.isDragging||this.mouseIsDown&&(this.lastMousePos.x!==e.clientX||this.lastMousePos.y!==e.clientY),s=!1===t&&!0===o;if(this.lastMousePos={x:e.clientX,y:e.clientY},!o)return;const r=this.getRoot().$el,i=r.getBoundingClientRect(),n=this.$refs.dragInfo,l=e.clientY-i.top+r.scrollTop-(0|n.style.marginBottom),a=e.clientX-i.left;n.style.top=l+"px",n.style.left=a+"px";const u=this.getCursorPositionFromCoords(e.clientX,e.clientY),d=u.node,c=u.placement;s&&!d.isSelected&&this.select(d.path,!1,e);const h=this.getDraggable();if(!this._checkAllowDrag(h,e))return void(this.preventDrag=!0);this.isDragging=o,this.setCursorPosition({node:d,placement:c}),this.dropAllow=this._checkAllowDrop(h,{node:d,placement:c},e),this.dropMove=this.dropAllow&&!e.ctrlKey||e.shiftKey,this.dropCopy=this.dropAllow&&e.ctrlKey&&!e.shiftKey;const p=i.bottom-this.scrollAreaHeight,g=(e.clientY-p)/(i.bottom-p),f=i.top+this.scrollAreaHeight,v=(f-e.clientY)/(f-i.top);g>0?this.startScroll(g):v>0?this.startScroll(-v):this.stopScroll()},getCursorPositionFromCoords(e,t){const o=document.elementFromPoint(e,t),s=o.getAttribute("path")?o:o.closest("[path]");let r,i;if(s){if(!s)return;r=this.getNode(JSON.parse(s.getAttribute("path")));const e=s.offsetHeight,o=this.edgeSize,n=t-s.getBoundingClientRect().top;i=r.isLeaf?n>=e/2?"after":"before":n<=o?"before":n>=e-o?"after":"inside"}else{const e=this.getRoot().$el.getBoundingClientRect();t>e.top+e.height/2?(i="after",r=this.getLastNode()):(i="before",r=this.getFirstNode())}return{node:r,placement:i}},onMouseleaveHandler(e){if(!this.isRoot||!this.isDragging)return;const t=this.getRoot().$el.getBoundingClientRect();e.clientY>=t.bottom?this.setCursorPosition({node:this.nodes.slice(-1)[0],placement:"after"}):e.clientY<t.top&&this.setCursorPosition({node:this.getFirstNode(),placement:"before"})},getNodeEl(e){return this.getRoot().$el.querySelector(`[path="${JSON.stringify(e)}"]`)},getLastNode(){let e=null;return this.traverse(t=>{e=t}),e},getFirstNode(){return this.getNode([0])},getNextNode(e,t=null){let o=null;return this.traverse(s=>{if(!(this.comparePaths(s.path,e)<1))return!t||t(s)?(o=s,!1):void 0}),o},getPrevNode(e,t){let o=[];this.traverse(t=>{if(this.comparePaths(t.path,e)>=0)return!1;o.push(t)});let s=o.length;for(;s--;){const e=o[s];if(!t||t(e))return e}return null},getParentNode(e){return 1===e.length?null:this.getNode(e.slice(0,e.length-1))},getParentNodes(e){const t=[];let o=[...e];for(let s=0;s<e.length-1;s++)o=o.slice(0,o.length-1),t.unshift(this.getNode(o));return t},comparePaths(e,t){for(let o=0;o<e.length;o++){if(void 0===t[o])return 1;if(e[o]>t[o])return 1;if(e[o]<t[o])return-1}return void 0===t[e.length]?0:-1},onNodeMousedownHandler(e,t){0===e.button&&(this.isRoot?this.mouseIsDown=!0:this.getRoot().onNodeMousedownHandler(e,t))},startScroll(e){const t=this.getRoot().$el;this.scrollSpeed!==e&&(this.scrollIntervalId&&this.stopScroll(),this.scrollSpeed=e,this.scrollIntervalId=setInterval(()=>{t.scrollTop+=this.maxScrollSpeed*e},20))},stopScroll(){clearInterval(this.scrollIntervalId),this.scrollIntervalId=0,this.scrollSpeed=0},onDocumentMouseupHandler(e){this.isDragging&&this.onNodeMouseupHandler(e)},onNodeMouseupHandler(e,t=null){if(0!==e.button)return;if(!this.isRoot)return void this.getRoot().onNodeMouseupHandler(e,t);if(this.mouseIsDown=!1,this.isDragging||!t||this.preventDrag||this.select(t.path,!1,e),this.preventDrag=!1,!this.cursorPosition||!this.dropAllow)return void this.stopDrag();const o=this.getDraggable();for(let e of o){if(!e.isAllowDrag)return void this.stopDrag();if(e.pathStr===this.cursorPosition.node.pathStr)return void this.stopDrag();if(this.checkNodeIsParent(e,this.cursorPosition.node))return void this.stopDrag()}const s=this.copy(this.currentValue),r=[];for(let e of o){const t=this.getNodeSiblings(s,e.path)[e.ind];r.push(this.copy(t)),t._copySource=this.dropCopy,t._markToDelete=this.dropMove}const i=this.cursorPosition.node,n=this.getNodeSiblings(s,i.path),l=n[i.ind];if("inside"===this.cursorPosition.placement)l.children=l.children||[],l.children.unshift(...r);else{const e="before"===this.cursorPosition.placement?i.ind:i.ind+1;n.splice(e,0,...r)}this.traverseModels((e,t,o)=>{e._markToDelete?t.splice(o,1):e._copySource&&(e.isSelected=!1)},s),this.lastSelectedNode=null,this.emitInput(s),this.emitDrop(o,this.cursorPosition,e),this.stopDrag()},onToggleHandler(e,t){this.updateNode(t.path,{isExpanded:!t.isExpanded}),this.emitToggle(t,e),e.stopPropagation()},stopDrag(){this.isDragging=!1,this.dropAllow=!0,this.mouseIsDown=!1,this.setCursorPosition(null),this.stopScroll()},getParent(){return this.$parent},getRoot(){return this.isRoot?this:this.getParent().getRoot()},getNodeSiblings(e,t){return 1===t.length?e:this.getNodeSiblings(e[t[0]].children,t.slice(1))},updateNode(e,t){if(!this.isRoot)return void this.getParent().updateNode(e,t);const o=JSON.stringify(e),s=this.copy(this.currentValue);this.traverse((e,s)=>{e.pathStr===o&&Object.assign(s,t)},s),this.emitInput(s)},getSelected(){const e=[];return this.traverse(t=>{t.isSelected&&e.push(t)}),e},getDraggable(){const e=[];return this.traverse(t=>{t.isSelected&&t.isDraggable&&e.push(t)}),e},traverse(e,t=null,o=[]){t||(t=this.currentValue);let s=!1;const r=[];for(let i=0;i<t.length;i++){const n=t[i],l=o.concat(i),a=this.getNode(l,n,t);if(s=!1===e(a,n,t),r.push(a),s)break;if(n.children&&(s=!1===this.traverse(e,n.children,l)))break}return!s&&r},traverseModels(e,t){let o=t.length;for(;o--;){const s=t[o];s.children&&this.traverseModels(e,s.children),e(s,t,o)}return t},remove(e){const t=e.map(e=>JSON.stringify(e)),o=this.copy(this.currentValue);this.traverse((e,o,s)=>{for(const s of t)e.pathStr===s&&(o._markToDelete=!0)},o),this.traverseModels((e,t,o)=>{e._markToDelete&&t.splice(o,1)},o),this.emitInput(o)},removeNodes(e){return this.remove(e)},checkNodeIsParent(e,t){const o=t.path;return JSON.stringify(o.slice(0,e.path.length))===e.pathStr},copy:e=>JSON.parse(JSON.stringify(e))}},r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"sl-vue-tree",class:{"sl-vue-tree-root":e.isRoot,"sl-vue-tree-drop-forbidden":e.isDragging&&!e.dropAllow,"sl-vue-tree-drop-move":e.isDragging&&e.dropMove,"sl-vue-tree-drop-copy":e.isDragging&&e.dropCopy},on:{mousemove:e.onMousemoveHandler,mouseleave:e.onMouseleaveHandler,dragend:function(t){e.onDragendHandler(null,t)}}},[o("div",{ref:"nodes",staticClass:"sl-vue-tree-nodes-list"},[e._l(e.nodes,function(t,s){return o("div",{staticClass:"sl-vue-tree-node",class:{"sl-vue-tree-selected":t.isSelected}},[o("div",{staticClass:"sl-vue-tree-cursor sl-vue-tree-cursor_before",style:{visibility:e.cursorPosition&&e.cursorPosition.node.pathStr===t.pathStr&&"before"===e.cursorPosition.placement?"visible":"hidden"},on:{dragover:function(e){e.preventDefault()}}}),e._v(" "),o("div",{staticClass:"sl-vue-tree-node-item",class:{"sl-vue-tree-cursor-hover":e.cursorPosition&&e.cursorPosition.node.pathStr===t.pathStr,"sl-vue-tree-cursor-inside":e.cursorPosition&&"inside"===e.cursorPosition.placement&&e.cursorPosition.node.pathStr===t.pathStr,"sl-vue-tree-node-is-leaf":t.isLeaf,"sl-vue-tree-node-is-folder":!t.isLeaf},attrs:{path:t.pathStr},on:{mousedown:function(o){e.onNodeMousedownHandler(o,t)},mouseup:function(o){e.onNodeMouseupHandler(o,t)},contextmenu:function(o){e.emitNodeContextmenu(t,o)},dblclick:function(o){e.emitNodeDblclick(t,o)},click:function(o){e.emitNodeClick(t,o)},dragover:function(o){e.onExternalDragoverHandler(t,o)},drop:function(o){e.onExternalDropHandler(t,o)}}},[e._l(e.gaps,function(e){return o("div",{staticClass:"sl-vue-tree-gap"})}),e._v(" "),e.level&&e.showBranches?o("div",{staticClass:"sl-vue-tree-branch"},[e._t("branch",[t.isLastChild?e._e():o("span",[e._v("\n            "+e._s(String.fromCharCode(9500))+e._s(String.fromCharCode(9472))+" \n          ")]),e._v(" "),t.isLastChild?o("span",[e._v("\n            "+e._s(String.fromCharCode(9492))+e._s(String.fromCharCode(9472))+" \n          ")]):e._e()],{node:t})],2):e._e(),e._v(" "),o("div",{staticClass:"sl-vue-tree-title"},[t.isLeaf?e._e():o("span",{staticClass:"sl-vue-tree-toggle",on:{click:function(o){e.onToggleHandler(o,t)}}},[e._t("toggle",[o("span",[e._v("\n             "+e._s(t.isLeaf?"":t.isExpanded?"-":"+")+"\n            ")])],{node:t})],2),e._v(" "),e._t("title",[e._v(e._s(t.title))],{node:t})],2),e._v(" "),o("div",{staticClass:"sl-vue-tree-sidebar"},[e._t("sidebar",null,{node:t})],2)],2),e._v(" "),t.children&&t.children.length&&t.isExpanded?o("sl-vue-tree",{attrs:{value:t.children,level:t.level,parentInd:s,allowMultiselect:e.allowMultiselect,edgeSize:e.edgeSize,showBranches:e.showBranches},on:{dragover:function(e){e.preventDefault()}},scopedSlots:e._u([{key:"title",fn:function(t){var o=t.node;return[e._t("title",[e._v(e._s(o.title))],{node:o})]}},{key:"toggle",fn:function(t){var s=t.node;return[e._t("toggle",[o("span",[e._v("\n             "+e._s(s.isLeaf?"":s.isExpanded?"-":"+")+"\n          ")])],{node:s})]}},{key:"sidebar",fn:function(t){var o=t.node;return[e._t("sidebar",null,{node:o})]}}])}):e._e(),e._v(" "),o("div",{staticClass:"sl-vue-tree-cursor sl-vue-tree-cursor_after",style:{visibility:e.cursorPosition&&e.cursorPosition.node.pathStr===t.pathStr&&"after"===e.cursorPosition.placement?"visible":"hidden"},on:{dragover:function(e){e.preventDefault()}}})],1)}),e._v(" "),e.isRoot?o("div",{directives:[{name:"show",rawName:"v-show",value:e.isDragging,expression:"isDragging"}],ref:"dragInfo",staticClass:"sl-vue-tree-drag-info"},[e._t("draginfo",[e._v("\n        Items: "+e._s(e.selectionSize)+"\n      ")])],2):e._e()],2)])};r._withStripped=!0;var i=function(e,t,o,s,r,i,n,l){var a=typeof(e=e||{}).default;"object"!==a&&"function"!==a||(e=e.default);var u,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=o,d._compiled=!0),s&&(d.functional=!0),i&&(d._scopeId=i),n?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},d._ssrRegister=u):r&&(u=l?function(){r.call(this,this.$root.$options.shadowRoot)}:r),u)if(d.functional){d._injectStyles=u;var c=d.render;d.render=function(e,t){return u.call(t),c(e,t)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,u):[u]}return{exports:e,options:d}}(s,r,[],!1,null,null,null);i.options.__file="src/sl-vue-tree.vue";t.default=i.exports}}).default});
//# sourceMappingURL=sl-vue-tree.js.map